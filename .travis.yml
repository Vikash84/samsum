language: python
os: linux
dist: bionic
sudo: true
python:
- '3.6'
branches:
  only:
  - master
before_deploy:
- git config --local user.name "cmorganl"
- git config --local user.email "c.morganlang@gmail.com"
deploy:
  provider: pypi
  user: __token__
  password:
    secure: gSY9kHG8zC80SrrIV5+Aj/B56A7fx0s+Rsl9Oyzv+VrQEzjKkQfeLM0Tt+NI+ySaLMkmIIST7Qrz+OM5/dwJDDICJUrf2AKgz2BRxBacSCt+RqJEMgMRDYPA7hFKaZlO0xk5ce5WbrCoKqYuGntBkVvcyDozJurU7bhJNz2t2q9Xfx1FJph7POo+hY0+egFdZsLqFtaOglaG4Ynum65gjorKaTJQAJkLuUXTg/gT3QY8aKxfng0fNPj3K74J3vhOvukNQ05hHR62tdSHO5n7EnWDgiqjHJ1wQUszOTlzS8rIq9iczfx2JhcOjYSthUPqKqQYPTXfGR56hZxhjaEmWrM1QKzecci3edoJOtqfuaHPTv2qEcdV57gGAdEuhdNR3Na1OQLkcZODbbdw6a2/RjUUKkIIZoa7WwfrymKlc7RzmUmBsfmbSo0ktTkq5kR4mirWuaDKwRsscb3RW1hemI5sypYnOLJ6CGgwLKxFquwAeD4rlolQ7YSgW6ZeH0KhvvCy6whX1bdepA4j1HN9vHlD/Mvq9sPemrWX1Ya6I9LZKp3maFf8VKQNEodsDc2tkLO9HXhXNw8gkvhQUNc26gHl7tgyualtqIQmWb0b3p/GPVwCO29EhbzWYfCWoe/pQxAybZIzchqX0EQ7rPgEaOG/JWSz98e4uccD/lVZFKU=
  on:
    branch: master
  skip_existing: true
  skip_cleanup: true
env:
  global:
  - CIBW_SKIP="cp27-*"
  - TWINE_USERNAME=__token__
  - PIP="python3 -m pip"
  - TWINE_REPOSITORY=pypi
  - TWINE_REPOSITORY_URL=https://test.pypi.org/legacy/
  - TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)}
before_install:
- sudo apt -y install gcc dpkg-dev curl zip git libz-dev default-jdk python3-distutils
  python3-dev
install:
- "$PIP install -r requirements.txt"
- "$PIP install -U setuptools"
- "$PIP install cibuildwheel==1.1.0"
- "$PIP install --upgrade pip"
- "$PIP  install tox"
- "$PIP --version"
- "$PIP --version"
script:
- tox -v
- python3 -m cibuildwheel --output-dir wheelhouse
- python3 setup.py sdist --dist-dir wheelhouse
jobs:
  include:
  - services: docker
  - os: osx
    language: shell
notifications:
  email:
    on_success: never
    on_failure: always
after_success:
- ls wheelhouse/
- |
  if [[ $TRAVIS_TAG ]]; then
    $PIP install twine
    python3 -m twine upload --skip-existing wheelhouse/*.whl
  fi
